server {
	listen 80;
	server_name _;

	root /usr/share/nginx/html;
	index app.html;

	# Security headers (basic)
	add_header X-Content-Type-Options "nosniff" always;
	add_header X-Frame-Options "DENY" always;
	add_header Referrer-Policy "strict-origin-when-cross-origin" always;
	add_header Permissions-Policy "geolocation=(), microphone=(), camera=()" always;

	# Gzip compression
	gzip on;
	gzip_comp_level 6;
	gzip_min_length 1024;
	gzip_vary on;
	gzip_types
		text/plain
		text/css
		application/json
		application/javascript
		text/xml
		application/xml
		application/xml+rss
		image/svg+xml;

	# Service worker should not be cached (allow updates)
	location = /service-worker.js {
		add_header Cache-Control "no-cache, no-store, must-revalidate" always;
		try_files $uri =404;
	}

	# Manifest - cache moderately
	location = /manifest.json {
		add_header Cache-Control "public, max-age=3600" always;
		try_files $uri =404;
	}

	# Static assets - long cache
	location ~* \.(?:js|css|png|jpg|jpeg|gif|svg|ico|woff2?)$ {
		add_header Cache-Control "public, max-age=31536000, immutable" always;
		try_files $uri =404;
	}

	# SPA fallback (SvelteKit adapter-static fallback is app.html)
	location / {
		try_files $uri $uri/ /app.html;
	}
}

